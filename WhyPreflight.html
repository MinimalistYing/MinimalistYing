<!DOCTYPE html><html><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<meta name="baidu-site-verification" content="e7Xf8PjkZ4">
	<meta name="description" content="小影子的博客，记录工作经验，分享前端技术~">
	<meta name="keyword" content="博客 前端 技术 Blog FrontEnd Experience">
	<title>MinimalistYing.io</title>
	<script charset="utf-8" src="https://hmcdn.baidu.com/static/tongji/plugins/UrlChangeTracker.js"></script><script src="https://hm.baidu.com/hm.js?a3319bfaaf51660db9fb0bbf68d309cb"></script><script>
		var _hmt = _hmt || [];
		(function() {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?a3319bfaaf51660db9fb0bbf68d309cb";
			var s = document.getElementsByTagName("script")[0]; 
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
<link rel="shortcut icon" href="favicon.ico"><link href="main.963473cab43172722d02.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="0.34dc1d228a2b3001916f.css"><script charset="utf-8" src="0.9d82b534399ca40448c9.bundle.js"></script><script charset="utf-8" src="5.4749751c69454854f14e.bundle.js"></script><link rel="stylesheet" type="text/css" href="2.1102e7ba37877810cde5.css"><script charset="utf-8" src="2.2397e918c534f0d6fc83.bundle.js"></script></head>
<body>
	<div id="app"><div><header><h3 class="header-title">MinimalistYing.io</h3><nav><ul><li><a href="/index.html">博客</a></li><li><a href="/memo.html">备忘</a></li><li><a href="https://codepen.io/MinimalistYing" target="_blank">代码库</a></li><li><a href="https://leetcode.com/MinimalistYing" target="_blank">Leetcode</a></li><li><a href="https://stackoverflow.com/users/8459774/minimalistying" target="_blank">StackOverflow</a></li><li><a href="https://github.com/MinimalistYing" target="_blank">Github</a></li></ul></nav></header><div class="blogs"><div class="blog"><div class="my-md"><h1 id="-cors-preflight-">为什么 CORS 需要在跨域请求前进行预校验 (Preflight)</h1>
<p>大家都知道浏览器在发起复杂跨域请求前会先发送一个 <code>OPTIONS</code> 请求来进行预校验<br>校验通过后才会正式将携带参数的请求发送给服务器<br>平时谈论的大多是什么情况下会需要预校验<br>不知道大家有没有仔细考虑过浏览器为什么会这么做？<br>不这么做又会导致什么问题？</p>
<p>下面先来看看 <a href="https://www.w3.org/TR/cors/#preflight-request">W3C 协议</a> 中的说法：</p>
<blockquote>
<p>To protect resources against cross-origin requests that could not originate from certain user agents<br>before this specification existed a preflight request is made to ensure that the resource is aware of this specification.</p>
</blockquote>
<p>光看这段文字可能大家还是一头雾水，下面让我们用一个例子来更加形象的描述一下这个问题<br>假设浏览器并不会发送预检验（Preflight）请求，而是直接发送正式请求来判断是否允许跨域<br>我们向服务器发送一个跨域的 <code>DELETE</code> 请求 <code>https://www.a.com/deleteuser?id=123</code> 来删除一个用户  </p>
<h2 id="-cors">服务端正确设置了 CORS</h2>
<p>这种情况下无论是否先发起预检验请求都没有问题<br>假设不发送，服务器也可以直接根据正式请求的来源域以及请求头来判断是否接受该跨域请求<br>未通过则返回告诉浏览器不允许该跨域请求<br>反之请求通过了跨域校验则继续按正常流程处理  </p>
<h2 id="-cors">服务端未正确设置 CORS</h2>
<p>比如服务端使用的仍是在 CORS 出现前开发的代码<br>这个时候如果浏览器不做预检验，直接将真实请求发至服务器来判断是否满足跨域条件<br>服务器接受到了如上的 <code>DELETE</code> 请求，由于并未设置过 CORS<br>也就是说服务器会默认浏览器发来的请求都是满足同源策略的<br>便直接将该请求当作普通请求进行处理<br>虽然浏览器端虽然可能会发现响应中并没有 CORS 相关端响应头而抛出跨域错误<br>但是服务端实际上已经将请求接受
在这种情况下浏览器的同源策略就不攻自破了</p>
<h2 id="-">预检验请求为什么能解决这个问题</h2>
<p>大家都知道，预检验请求是一个不携带任何具体参数的 <code>OPTIONS</code> 请求<br>采用 CORS 的服务器会正确的根据请求头来判断是否接受该跨域请求，并返回相应的响应告知浏览器<br>未采用的服务器接受到请求也会正常处理<br>但是返回的响应中不会正确的包含 Access-Control-Allow-* 等响应头<br>浏览器接收到预检验请求的响应后会根据响应头来判断是否支持跨域<br>只有当响应头满足 CORS 的相关设置才会继续发送正式的跨域请求</p>
</div></div><div id="category" class="category-box"><ul class="blogs-category"><li class="">记一次 Chrome 更新导致插件故障引发的问题</li><li class="">关于前端框架选型的一些思考</li><li class="">观后感：《低欲望社会》大前研一</li><li class="">浅谈 CSS（Cascading Style Sheets) 之层叠</li><li class="">Axios 源码解析</li><li class="">React 与 Vue 的一些对比</li><li class="selected">为什么 CORS 需要在跨域请求前进行预校验 (Preflight)</li><li class="">Array.prototype.sort() 在使用默认 CompareFn 时的问题</li><li class="">常见的二叉树类型</li><li class="">Ajax (Asynchronous JavaScript And XML)</li><li class="">关于 XSS 以及 CSRF</li><li class="">Cookie 和 WebStorage</li><li class="">关于跨域</li><li class="">记录配置 Webpack 过程中碰到的问题以及解决方案</li><li class="">关于 Source Map 以及 Webpack 中 Devtool 的相关配置</li><li class="">二叉树的遍历</li><li class="">React-Redux 从入门到后悔</li><li class="">Redux 从入门到放弃</li><li class="">如何阻止模态框 (Modal / Popup / Dialog) 弹出后 Body 可滚动</li><li class="">Promise In ES6</li><li class="">New Collections In ES6</li><li class=""> Object's New API In ES6</li><li class="">Array's New API In ES6</li><li class="">Generator in ES6</li><li class="">Webpack V3 升级至 V4</li><li class="">Iterator in ES6</li><li class="">Symbols in ES6</li><li class="">如何编写一个自己的GulpPlugin</li><li class="">Webpack(v3.8.1)</li></ul></div><div class="category-toggle"></div></div></div></div>
<script type="text/javascript" src="main.ad613e76dfba0372d7c6.js"></script>
</body></html>