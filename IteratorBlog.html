<!DOCTYPE html><html><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<meta name="baidu-site-verification" content="e7Xf8PjkZ4">
	<meta name="description" content="小影子的博客，记录工作经验，分享前端技术~">
	<meta name="keyword" content="博客 前端 技术 Blog FrontEnd Experience">
	<title>MinimalistYing.io</title>
	<script charset="utf-8" src="https://hmcdn.baidu.com/static/tongji/plugins/UrlChangeTracker.js"></script><script src="https://hm.baidu.com/hm.js?a3319bfaaf51660db9fb0bbf68d309cb"></script><script>
		var _hmt = _hmt || [];
		(function() {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?a3319bfaaf51660db9fb0bbf68d309cb";
			var s = document.getElementsByTagName("script")[0]; 
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
<link rel="shortcut icon" href="favicon.ico"><link href="main.da41f8ae8d650f389d21.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="0.ef1bd9dbce806a540650.css"><script charset="utf-8" src="0.e3fc404a03ea51474c0f.bundle.js"></script><script charset="utf-8" src="5.4749751c69454854f14e.bundle.js"></script><link rel="stylesheet" type="text/css" href="2.41696c5507cad7d5f341.css"><script charset="utf-8" src="2.510b9aa996f2336192b4.bundle.js"></script></head>
<body>
	<div id="app"><div><header><h3 class="header-title">MinimalistYing.io</h3><nav><ul><li><a href="/index.html">博客</a></li><li><a href="/memo.html">备忘</a></li><li><a href="https://codepen.io/MinimalistYing" target="_blank">代码库</a></li><li><a href="https://leetcode.com/MinimalistYing" target="_blank">Leetcode</a></li><li><a href="https://stackoverflow.com/users/8459774/minimalistying" target="_blank">StackOverflow</a></li><li><a href="https://github.com/MinimalistYing" target="_blank">Github</a></li></ul></nav></header><div class="blogs"><div class="blog"><div class="my-md"><h1 id="iterator-in-es6">Iterator in ES6</h1>
<h2 id="iterator-iterable">Iterator 与 Iterable</h2>
<p>Iterator 可以看做一个拥有固定格式的对象，可供 ES6 新增的遍历 <code>for of</code> 和解构 <code>...</code> 等消费，并按顺序依次产出结果，样例如下</p>
<pre><code class="language-js"><span class="hljs-comment">// 除了以下俩个值外也可以额外返回更多的自定义属性</span>
<span class="hljs-keyword">const</span> IteratorResult = {
    <span class="hljs-attr">value</span>: ..., <span class="hljs-comment">// 每次迭代产出的真实值</span>
    done: ..., <span class="hljs-comment">// true|false true代表迭代结束 与true相对应的value一般建议为undefined</span>
}

<span class="hljs-keyword">const</span> Iterator = {
    <span class="hljs-comment">// 必须 用于返回每次迭代的结果集</span>
    next() { <span class="hljs-keyword">return</span> IteratorResult},
    <span class="hljs-comment">// 可选 提前结束迭代时做相应的资源清理操作并返回最后的结果集</span>
    <span class="hljs-keyword">return</span>() {},
    <span class="hljs-comment">// 可选 抛出异常信息并返回最后的结果集</span>
    <span class="hljs-keyword">throw</span>() {}
}</code></pre>
<p>一个对象如果实现了 Iterable 接口则被称为 Iterabel 对象(简单来说就是对象上有一个 key 为 <code>Symbol.iterator</code> 的方法并且这个的返回值为 Iterator)</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> Iterable = {
    [<span class="hljs-built_in">Symbol</span>.iterator]() {<span class="hljs-keyword">return</span> Iterator}
}</code></pre>
<h2 id="-iterable-">如何构造一个简单的 Iterable 对象</h2>
<pre><code class="language-js"><span class="hljs-keyword">let</span> rand = <span class="hljs-built_in">Math</span>.random()
<span class="hljs-comment">// 会随机产生一串数字的Iterable对象</span>
<span class="hljs-keyword">const</span> iterable = {
    <span class="hljs-comment">// 必备!!! 这样才能使该对象 Iterable</span>
    [<span class="hljs-built_in">Symbol</span>.iterator]() {<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>},
    <span class="hljs-comment">// 依次去获取数据</span>
    next() {
        <span class="hljs-keyword">if</span> (rand &gt; <span class="hljs-number">0.5</span>) {
            rand = <span class="hljs-built_in">Math</span>.random()
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">value</span>: rand,
                <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>
            }
        }
    }
}
<span class="hljs-comment">// 该对象可以用 for of 遍历</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> value <span class="hljs-keyword">of</span> iterable) {
    <span class="hljs-built_in">console</span>.log(value)
}</code></pre>
<h2 id="-iterable-">如何构造一个完整的 Iterable 对象</h2>
<pre><code class="language-js"><span class="hljs-comment">// 该对象可以步进的产生对数据的每一步累加结果</span>
<span class="hljs-keyword">const</span> stepAccumulator = {
    [<span class="hljs-built_in">Symbol</span>.iterator]() {
        <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>
        <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">this</span>.data.slice()
        <span class="hljs-keyword">let</span> done = <span class="hljs-literal">false</span>
        <span class="hljs-keyword">return</span> {
            <span class="hljs-comment">// 使迭代器(Iterator)本身可迭代(Iterable)</span>
            [<span class="hljs-built_in">Symbol</span>.iterator]() { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> },
            next() {
                <span class="hljs-keyword">const</span> value = sum += data[index]
                index++
                <span class="hljs-keyword">if</span> (index &lt;= data.length &amp;&amp; !done) {
                    <span class="hljs-keyword">return</span> {
                        value,
                        <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span>
                    }
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">return</span> {
                        <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>
                    }
                }
            },
            <span class="hljs-keyword">return</span>(v) {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'abandoned'</span>)
                done = <span class="hljs-literal">true</span>
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">value</span>: v,
                    <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>
                }
            },
            <span class="hljs-keyword">throw</span>(e) {
                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'error'</span>)
                done = <span class="hljs-literal">true</span>
                <span class="hljs-keyword">return</span> {
                    <span class="hljs-attr">value</span>: e,
                    <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span>
                }
            }
        }
    },
    <span class="hljs-attr">data</span>: []
}
<span class="hljs-comment">// 设置数据</span>
stepAccumulator.data = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
<span class="hljs-built_in">console</span>.log(...stepAccumulator) <span class="hljs-comment">// 1 3 6</span>

<span class="hljs-comment">// 1 3 'abandoned'</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> stepAccumulator) {
    <span class="hljs-built_in">console</span>.log(v)
    <span class="hljs-keyword">if</span> (v &gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">break</span>
}

<span class="hljs-keyword">const</span> it = stepAccumulator[<span class="hljs-built_in">Symbol</span>.iterator]()
it.next() <span class="hljs-comment">// { value:1, done: false }</span>
it.throw(<span class="hljs-string">'!!!'</span>) <span class="hljs-comment">// 'error' { vallue:'!!!', done: true }</span>
it.next() <span class="hljs-comment">// { done: true }</span></code></pre>
<ul>
<li><code>return()</code> 和 <code>throw()</code> 都可以通过 <strong>Iterator</strong> 调用，并且调用后意味着迭代终止，之后便不能通过该迭代器获取到更多的值</li>
<li>一般来说 <strong>Iterable</strong> 对象支持同时生成多个 <strong>Iterator</strong>，且相互间的迭代不会互相影响，当然你也可以把迭代器设为单例</li>
<li>任何一种取消或者提前终止迭代的操作都会使 <strong>Iterator</strong> 自动调用 <code>return()</code> 来处理相关清理工作</li>
</ul>
<h2 id="es6-iterable-">ES6 原生支持的 Iterable 数据结构</h2>
<p>包括 <code>String</code> <code>Map</code> <code>Set</code> <code>Array</code> 等</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> str = <span class="hljs-string">'abc'</span>
<span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]
<span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Map</span>()
map.set(<span class="hljs-string">'a'</span>, <span class="hljs-number">1</span>)
map.set(<span class="hljs-string">'b'</span>, <span class="hljs-number">2</span>)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> str) {
    <span class="hljs-built_in">console</span>.log(v) <span class="hljs-comment">// 'a' 'b' 'c'</span>
}
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> arr) {
    <span class="hljs-built_in">console</span>.log(v) <span class="hljs-comment">// 1 2 3</span>
}
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> v <span class="hljs-keyword">of</span> map) {
    <span class="hljs-built_in">console</span>.log(v) <span class="hljs-comment">// ['a', 1] ['b', 2]</span>
}</code></pre>
</div></div><div id="category" class="category-box"><ul class="blogs-category"><li id="AliYunECS" class="">我是如何把个人网站从 GitHub Page 迁上阿里云的</li><li id="AntdForm" class="">Ant Design 表单的一些进阶使用方式</li><li id="CSSModules" class="">CSS Modules</li><li id="GuiLin" class="">桂林山，阳朔水</li><li id="MongoTooManyOpenFiles" class="">记一次解决 MongoDB 报错的心路历程</li><li id="MoesifBug" class="">记一次 Chrome 更新导致插件故障引发的问题</li><li id="Frameworks" class="">关于前端框架选型的一些思考</li><li id="LowDesireSociety" class="">观后感：《低欲望社会》大前研一</li><li id="Cascading" class="">浅谈 CSS（Cascading Style Sheets) 之层叠</li><li id="Axios" class="">Axios 源码解析</li><li id="VueVsReact" class="">React 与 Vue 的一些对比</li><li id="WhyPreflight" class="">为什么 CORS 需要在跨域请求前进行预校验 (Preflight)</li><li id="ArraySort" class="">Array.prototype.sort() 在使用默认 CompareFn 时的问题</li><li id="BinaryTreeType" class="">常见的二叉树类型</li><li id="Ajax" class="">Ajax (Asynchronous JavaScript And XML)</li><li id="XSSCSRF" class="">关于 XSS 以及 CSRF</li><li id="CookieAndWebStorage" class="">Cookie 和 WebStorage</li><li id="CrossOrigin" class="">关于跨域</li><li id="WebpackCommonProblem" class="">记录配置 Webpack 过程中碰到的问题以及解决方案</li><li id="SourceMapAndWebpack" class="">关于 Source Map 以及 Webpack 中 Devtool 的相关配置</li><li id="BinaryTreeTraversal" class="">二叉树的遍历</li><li id="ReactRedux" class="">React-Redux 从入门到后悔</li><li id="Redux" class="">Redux 从入门到放弃</li><li id="PreventModalScroll" class="">如何阻止模态框 (Modal / Popup / Dialog) 弹出后 Body 可滚动</li><li id="PromiseBlog" class="">Promise In ES6</li><li id="Collections" class="">New Collections In ES6</li><li id="ObjectAPI" class=""> Object's New API In ES6</li><li id="ArrayAPI" class="">Array's New API In ES6</li><li id="Generator" class="">Generator in ES6</li><li id="WebpackV3ToV4" class="">Webpack V3 升级至 V4</li><li id="IteratorBlog" class="selected">Iterator in ES6</li><li id="SymbolBlog" class="">Symbols in ES6</li><li id="GulpPlugin" class="">如何编写一个自己的GulpPlugin</li><li id="WebpackBaseConfig" class="">Webpack(v3.8.1)</li></ul></div><div class="category-toggle"></div></div></div></div>
<script type="text/javascript" src="main.0fd9269aceaf15c44979.js"></script>
</body></html>