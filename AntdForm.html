<!DOCTYPE html><html><head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0">
	<meta name="baidu-site-verification" content="e7Xf8PjkZ4">
	<meta name="description" content="小影子的博客，记录工作经验，分享前端技术~">
	<meta name="keyword" content="博客 前端 技术 Blog FrontEnd Experience">
	<title>MinimalistYing.io</title>
	<script charset="utf-8" src="https://hmcdn.baidu.com/static/tongji/plugins/UrlChangeTracker.js"></script><script src="https://hm.baidu.com/hm.js?a3319bfaaf51660db9fb0bbf68d309cb"></script><script>
		var _hmt = _hmt || [];
		(function() {
			var hm = document.createElement("script");
			hm.src = "https://hm.baidu.com/hm.js?a3319bfaaf51660db9fb0bbf68d309cb";
			var s = document.getElementsByTagName("script")[0]; 
			s.parentNode.insertBefore(hm, s);
		})();
	</script>
<link rel="shortcut icon" href="favicon.ico"><link href="main.da41f8ae8d650f389d21.css" rel="stylesheet"><link rel="stylesheet" type="text/css" href="0.ef1bd9dbce806a540650.css"><script charset="utf-8" src="0.e3fc404a03ea51474c0f.bundle.js"></script><script charset="utf-8" src="5.4749751c69454854f14e.bundle.js"></script><link rel="stylesheet" type="text/css" href="2.41696c5507cad7d5f341.css"><script charset="utf-8" src="2.510b9aa996f2336192b4.bundle.js"></script></head>
<body>
	<div id="app"><div><header><h3 class="header-title">MinimalistYing.io</h3><nav><ul><li><a href="/index.html">博客</a></li><li><a href="/memo.html">备忘</a></li><li><a href="https://codepen.io/MinimalistYing" target="_blank">代码库</a></li><li><a href="https://leetcode.com/MinimalistYing" target="_blank">Leetcode</a></li><li><a href="https://stackoverflow.com/users/8459774/minimalistying" target="_blank">StackOverflow</a></li><li><a href="https://github.com/MinimalistYing" target="_blank">Github</a></li></ul></nav></header><div class="blogs"><div class="blog"><div class="my-md"><h1 id="ant-design-">Ant Design 表单的一些进阶使用方式</h1>
<h2 id="getfielddecorator-"><code>getFieldDecorator</code> 如何支持嵌套结构</h2>
<p>在使用 Ant Design 的表单时，通常我们都希望与后端交互的数据结构尽可能扁平化，这样表单在设值和提交时都会很简单。<br>但是难免会碰到这样那样的原因导致数据结构会出现嵌套，其实 <code>getFieldDecorator</code> 也是支持这样的数据结构的。<br>例如，当后端定义的接口入参形式如下:</p>
<pre><code class="language-json">{
  <span class="hljs-string">"person"</span>: {
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Jack Ma"</span>,
    <span class="hljs-string">"age"</span>: <span class="hljs-number">18</span>
  },
  <span class="hljs-string">"education"</span>: [<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>]
}</code></pre>
<p>假设我们现在的需求是实现一个表单可以修改这些值并提交。<br>比较笨的办法是我们自己在前端的时候先当作扁平的数据处理，例如通过</p>
<pre><code class="language-js"><span class="hljs-keyword">const</span> value = {
  <span class="hljs-attr">personName</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">personAge</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">educationFirst</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">educationSecond</span>: <span class="hljs-string">''</span>
}</code></pre>
<p>如上数据结构来存储表单的值，在最后发起请求前再将格式转化为后端所需要的嵌套格式。<br>很明显，如果使用这种方式的话在表单回填和提交时我们都要多做一步转化操作，不够简洁。<br>下面让我们来看看更好的方式</p>
<pre><code class="language-js">import { Form, Input, Icon, Button, InputNumber } from 'antd'

class App extends React.Component {
  state = {
    value: {
      person: {
        name: 'Jack Ma',
        age: 18
      },
      education: [
        'a',
        'b'
      ]
    }
  }

  componentDidMount () {
    this.props.form.setFieldsValue(this.state.value)
  }

  handleSubmit = e =&gt; {
    e.preventDefault()
    this.props.form.validateFields((err, values) =&gt; {
      if (!err) {
        console.log('Received values of form: ', values)
      }
    })
  }

  render() {
    const { getFieldDecorator, getFieldValue } = this.props.form
    return (
      <span class="hljs-tag">&lt;<span class="hljs-name">Form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{this.handleSubmit}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'name'</span>&gt;</span>
          {getFieldDecorator(`person.name`)(
            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> /&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'age'</span>&gt;</span>
          {getFieldDecorator(`person.age`)(
            <span class="hljs-tag">&lt;<span class="hljs-name">InputNumber</span> /&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'education 1'</span>&gt;</span>
          {getFieldDecorator(`education[0]`)(
            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> /&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span> <span class="hljs-attr">label</span>=<span class="hljs-string">'education 2'</span>&gt;</span>
          {getFieldDecorator(`education[1]`)(
            <span class="hljs-tag">&lt;<span class="hljs-name">Input</span> /&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Form.Item</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span> <span class="hljs-attr">htmlType</span>=<span class="hljs-string">"submit"</span>&gt;</span>
            Submit
          <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">Form.Item</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Form</span>&gt;</span>
    )
  }
}

const Wrapped = Form.create({ name: 'test' })(App)
ReactDOM.render(<span class="hljs-tag">&lt;<span class="hljs-name">Wrapped</span> /&gt;</span>, mountNode)</code></pre>
<p>因为 Ant Design 的 <code>getFieldDecorator</code> 可以通过 <code>[]</code> <code>.</code> 支持嵌套式的写法，所以哪怕是类似 <code>a.b[3].c.d</code> 这样更复杂的嵌套结构也可以很好的支持。<br>在实现需要可以动态增减表单项的表单时，这个技巧尤为好用。</p>
<h2 id="-getfielddecorator-">如何自定义表单组件并放在 getFieldDecorator 中使用</h2>
<p>有时候除了 Ant Design 提供的基础表单组件，我们也需要取实现一些自定义的表单组件。<br>当然我们也希望自定义的表单组件也能和基础组件一样被使用。</p>
</div></div><div id="category" class="category-box"><ul class="blogs-category"><li id="AntdForm" class="selected">Ant Design 表单的一些进阶使用方式</li><li id="CSSModules" class="">CSS Modules</li><li id="GuiLin" class="">桂林山，阳朔水</li><li id="MongoTooManyOpenFiles" class="">记一次解决 MongoDB 报错的心路历程</li><li id="MoesifBug" class="">记一次 Chrome 更新导致插件故障引发的问题</li><li id="Frameworks" class="">关于前端框架选型的一些思考</li><li id="LowDesireSociety" class="">观后感：《低欲望社会》大前研一</li><li id="Cascading" class="">浅谈 CSS（Cascading Style Sheets) 之层叠</li><li id="Axios" class="">Axios 源码解析</li><li id="VueVsReact" class="">React 与 Vue 的一些对比</li><li id="WhyPreflight" class="">为什么 CORS 需要在跨域请求前进行预校验 (Preflight)</li><li id="ArraySort" class="">Array.prototype.sort() 在使用默认 CompareFn 时的问题</li><li id="BinaryTreeType" class="">常见的二叉树类型</li><li id="Ajax" class="">Ajax (Asynchronous JavaScript And XML)</li><li id="XSSCSRF" class="">关于 XSS 以及 CSRF</li><li id="CookieAndWebStorage" class="">Cookie 和 WebStorage</li><li id="CrossOrigin" class="">关于跨域</li><li id="WebpackCommonProblem" class="">记录配置 Webpack 过程中碰到的问题以及解决方案</li><li id="SourceMapAndWebpack" class="">关于 Source Map 以及 Webpack 中 Devtool 的相关配置</li><li id="BinaryTreeTraversal" class="">二叉树的遍历</li><li id="ReactRedux" class="">React-Redux 从入门到后悔</li><li id="Redux" class="">Redux 从入门到放弃</li><li id="PreventModalScroll" class="">如何阻止模态框 (Modal / Popup / Dialog) 弹出后 Body 可滚动</li><li id="PromiseBlog" class="">Promise In ES6</li><li id="Collections" class="">New Collections In ES6</li><li id="ObjectAPI" class=""> Object's New API In ES6</li><li id="ArrayAPI" class="">Array's New API In ES6</li><li id="Generator" class="">Generator in ES6</li><li id="WebpackV3ToV4" class="">Webpack V3 升级至 V4</li><li id="IteratorBlog" class="">Iterator in ES6</li><li id="SymbolBlog" class="">Symbols in ES6</li><li id="GulpPlugin" class="">如何编写一个自己的GulpPlugin</li><li id="WebpackBaseConfig" class="">Webpack(v3.8.1)</li></ul></div><div class="category-toggle"></div></div></div></div>
<script type="text/javascript" src="main.60205f80f3b24de616b7.js"></script>
</body></html>